<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Docker镜像加速配置指南</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link
    href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css"
    rel="stylesheet"
  />
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: "#165DFF",
            success: "#00B42A",
            warning: "#FF7D00",
            danger: "#F53F3F",
            dark: "#1D2129",
            light: "#F2F3F5",
          },
          fontFamily: {
            sans: ["Inter", "system-ui", "sans-serif"],
            mono: ["Consolas", "Monaco", "monospace"],
          },
        },
      },
    };
  </script>
  <style type="text/tailwindcss">
    @layer utilities {
      .content-auto {
        content-visibility: auto;
      }
      .shadow-custom {
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
      }
      .transition-custom {
        transition: all 0.3s ease;
      }
      .code-block {
        position: relative;
      }
      .copy-btn {
        position: absolute;
        top: 8px;
        right: 8px;
        opacity: 0;
        transition: opacity 0.2s ease;
      }
      .section-hover:hover .copy-btn {
        opacity: 1;
      }
    }
  </style>
</head>
<body class="bg-light text-dark font-sans min-h-screen flex flex-col">
  <!-- 头部 -->
  <header class="bg-white shadow-custom sticky top-0 z-50">
    <div class="container mx-auto px-4 py-6">
      <h1
        class="text-[clamp(1.8rem,4vw,2.5rem)] font-bold text-primary flex items-center"
      >
        <i class="fa fa-docker text-2xl mr-3"></i>
        Docker镜像加速配置指南
      </h1>
      <p class="text-gray-600 mt-2 max-w-2xl">
        自动识别当前访问域名，一键配置Docker镜像加速，大幅提升拉取速度
      </p>
    </div>
  </header>

  <!-- 主要内容 -->
  <main class="flex-grow container mx-auto px-4 py-8">
    <!-- 加速源信息 -->
    <section class="bg-white rounded-xl shadow-custom p-6 mb-10">
      <h2 class="text-xl font-bold text-primary mb-4 flex items-center">
        <i class="fa fa-link mr-2"></i> 自动识别的加速源地址
      </h2>
      <p class="text-gray-600 mb-4">
        系统已根据当前访问域名生成加速源地址，以下配置将自动填充该地址：
      </p>
      <div
        class="code-block bg-gray-50 p-4 rounded-lg font-mono section-hover"
      >
        <span
          id="accelerator-address"
          class="text-lg font-semibold dynamic-link"
          >https://dhdhd.dockerhub.sxxpqp.top/</span
        >
        <button
          class="copy-btn bg-primary text-white px-3 py-1 rounded text-sm hover:bg-primary/90"
          id="copy-accelerator"
        >
          <i class="fa fa-copy mr-1"></i> 复制地址
        </button>
      </div>
      <p class="text-gray-500 text-sm mt-3">
        若地址显示异常，可手动输入当前访问域名：
        <span id="current-domain" class="font-mono"></span>
      </p>
    </section>

    <!-- Linux配置 -->
    <section class="bg-white rounded-xl shadow-custom p-6 mb-10">
      <h2 class="text-xl font-bold text-primary mb-6 flex items-center">
        <i class="fa fa-linux mr-2 text-warning"></i> Linux系统配置步骤
      </h2>

      <div class="space-y-6">
        <!-- 步骤1 -->
        <div class="border-l-4 border-primary pl-4 section-hover">
          <h3 class="font-bold text-lg mb-2 flex items-center">
            <i class="fa fa-file-text-o mr-2 text-primary"></i> 编辑Docker配置文件
          </h3>
          <p class="text-gray-600 mb-2">
            打开或创建Docker配置文件，输入以下命令：
          </p>
          <div class="code-block bg-gray-50 p-4 rounded-lg font-mono mt-2">
            <pre><code>sudo vi /etc/docker/daemon.json</code></pre>
            <button
              class="copy-btn bg-primary text-white px-3 py-1 rounded text-sm hover:bg-primary/90"
            >
              <i class="fa fa-copy mr-1"></i> 复制命令
            </button>
          </div>
        </div>

        <!-- 步骤2 -->
        <div class="border-l-4 border-primary pl-4 section-hover">
          <h3 class="font-bold text-lg mb-2 flex items-center">
            <i class="fa fa-code mr-2 text-primary"></i> 添加镜像加速配置
          </h3>
          <p class="text-gray-600 mb-2">
            在文件中粘贴以下内容（加速源已自动替换为当前域名）：
          </p>
          <div class="code-block bg-gray-50 p-4 rounded-lg font-mono mt-2">
            <pre><code>{
  "registry-mirrors": ["<span class="dynamic-link">https://dhdhd.dockerhub.sxxpqp.top/</span>"]
}</code></pre>
            <button
              class="copy-btn bg-primary text-white px-3 py-1 rounded text-sm hover:bg-primary/90"
            >
              <i class="fa fa-copy mr-1"></i> 复制配置
            </button>
          </div>
        </div>

        <!-- 步骤3 -->
        <div class="border-l-4 border-primary pl-4 section-hover">
          <h3 class="font-bold text-lg mb-2 flex items-center">
            <i class="fa fa-refresh mr-2 text-primary"></i> 重启Docker服务
          </h3>
          <p class="text-gray-600 mb-2">
            使配置生效需要重新加载Docker守护进程：
          </p>
          <div class="code-block bg-gray-50 p-4 rounded-lg font-mono mt-2">
            <pre><code>sudo systemctl daemon-reload
sudo systemctl restart docker</code></pre>
            <button
              class="copy-btn bg-primary text-white px-3 py-1 rounded text-sm hover:bg-primary/90"
            >
              <i class="fa fa-copy mr-1"></i> 复制命令
            </button>
          </div>
        </div>

        <!-- 步骤4 -->
        <div class="border-l-4 border-primary pl-4 section-hover">
          <h3 class="font-bold text-lg mb-2 flex items-center">
            <i class="fa fa-check-circle mr-2 text-success"></i> 验证配置效果
          </h3>
          <p class="text-gray-600 mb-2">
            运行测试命令查看是否配置成功：
          </p>
          <div class="code-block bg-gray-50 p-4 rounded-lg font-mono mt-2">
            <pre><code>docker run hello-world</code></pre>
            <button
              class="copy-btn bg-primary text-white px-3 py-1 rounded text-sm hover:bg-primary/90"
            >
              <i class="fa fa-copy mr-1"></i> 复制命令
            </button>
          </div>
          <p class="text-success mt-2">
            <i class="fa fa-info-circle mr-1"></i> 若显示"Hello from Docker!"，说明加速配置已生效
          </p>
        </div>
      </div>
    </section>

    <!-- Windows配置 -->
    <section class="bg-white rounded-xl shadow-custom p-6 mb-10">
      <h2 class="text-xl font-bold text-primary mb-6 flex items-center">
        <i class="fa fa-windows mr-2 text-primary"></i> Windows系统配置指南
      </h2>

      <div class="space-y-6">
        <!-- 步骤1 -->
        <div class="border-l-4 border-primary pl-4 section-hover">
          <h3 class="font-bold text-lg mb-2 flex items-center">
            <i class="fa fa-desktop mr-2 text-primary"></i> 打开Docker Desktop设置
          </h3>
          <p class="text-gray-600">
            启动Docker Desktop，点击右上角状态栏图标，选择"Settings"：
          </p>
          <div class="flex justify-center mt-2">
            <img
              src="https://picsum.photos/400/200?random=101"
              alt="Docker Desktop设置入口"
              class="rounded-lg shadow-md max-w-full"
            />
          </div>
        </div>

        <!-- 步骤2 -->
        <div class="border-l-4 border-primary pl-4 section-hover">
          <h3 class="font-bold text-lg mb-2 flex items-center">
            <i class="fa fa-cog mr-2 text-primary"></i> 编辑镜像加速配置
          </h3>
          <p class="text-gray-600 mb-2">
            在"Docker Engine"选项卡中，将以下配置粘贴到JSON编辑器：
          </p>
          <div class="code-block bg-gray-50 p-4 rounded-lg font-mono mt-2">
            <pre><code>{
  "experimental": false,
  "registry-mirrors": [
    "<span class="dynamic-link">https://dhdhd.dockerhub.sxxpqp.top/</span>"
  ]
}</code></pre>
            <button
              class="copy-btn bg-primary text-white px-3 py-1 rounded text-sm hover:bg-primary/90"
            >
              <i class="fa fa-copy mr-1"></i> 复制配置
            </button>
          </div>
        </div>

        <!-- 步骤3 -->
        <div class="border-l-4 border-primary pl-4 section-hover">
          <h3 class="font-bold text-lg mb-2 flex items-center">
            <i class="fa fa-save mr-2 text-primary"></i> 应用配置并重启
          </h3>
          <p class="text-gray-600 mb-2">
            点击"Apply & Restart"按钮，Docker会自动保存配置并重启：
          </p>
          <div class="flex justify-center mt-2">
            <img
              src="https://picsum.photos/400/200?random=102"
              alt="应用并重启按钮"
              class="rounded-lg shadow-md max-w-full"
            />
          </div>
        </div>

        <!-- 步骤4 -->
        <div class="border-l-4 border-primary pl-4 section-hover">
          <h3 class="font-bold text-lg mb-2 flex items-center">
            <i class="fa fa-terminal mr-2 text-primary"></i> 命令行验证
          </h3>
          <p class="text-gray-600 mb-2">
            打开PowerShell或命令提示符，输入以下命令：
          </p>
          <div class="code-block bg-gray-50 p-4 rounded-lg font-mono mt-2">
            <pre><code>docker run hello-world</code></pre>
            <button
              class="copy-btn bg-primary text-white px-3 py-1 rounded text-sm hover:bg-primary/90"
            >
              <i class="fa fa-copy mr-1"></i> 复制命令
            </button>
          </div>
          <p class="text-success mt-2">
            <i class="fa fa-check-circle mr-1"></i> 成功时会显示Docker欢迎信息，表明加速配置已生效
          </p>
        </div>
      </div>
    </section>

    <!-- 额外建议 -->
    <section class="bg-white rounded-xl shadow-custom p-6">
      <h2 class="text-xl font-bold text-primary mb-6 flex items-center">
        <i class="fa fa-lightbulb-o mr-2 text-warning"></i> 高级配置与问题解决
      </h2>

      <div class="grid md:grid-cols-2 gap-6">
        <!-- 建议1 -->
        <div class="bg-light p-4 rounded-lg section-hover">
          <h3 class="font-bold text-lg mb-2 flex items-center text-warning">
            <i class="fa fa-dns mr-2"></i> DNS解析优化
          </h3>
          <p class="text-gray-600">
            若遇域名解析失败，建议设置公共DNS：
          </p>
          <ul class="list-disc pl-5 mt-2 text-gray-600">
            <li>
              Linux：在 <code>/etc/resolv.conf</code> 中添加 <code>nameserver 223.5.5.5</code>
            </li>
            <li>
              Windows：网络适配器设置中修改首选DNS为 <code>223.5.5.5</code>
            </li>
          </ul>
        </div>

        <!-- 建议2 -->
        <div class="bg-light p-4 rounded-lg section-hover">
          <h3 class="font-bold text-lg mb-2 flex items-center text-warning">
            <i class="fa fa-proxy mr-2"></i> 代理冲突处理
          </h3>
          <p class="text-gray-600">
            使用代理时需关闭Docker代理设置：
          </p>
          <ul class="list-disc pl-5 mt-2 text-gray-600">
            <li>Linux：执行 <code>unset HTTP_PROXY HTTPS_PROXY</code></li>
            <li>Windows：Docker Desktop设置中取消勾选"Use system proxy settings"</li>
          </ul>
        </div>

        <!-- 建议3 -->
        <div class="bg-light p-4 rounded-lg section-hover">
          <h3 class="font-bold text-lg mb-2 flex items-center text-warning">
            <i class="fa fa-bolt mr-2"></i> 传输性能优化
          </h3>
          <p class="text-gray-600">提升镜像拉取速度的进阶配置：</p>

          <div
            class="code-block bg-gray-50 p-3 rounded-lg font-mono mt-2"
          >
            <pre><code>{
  "registry-mirrors": [
    "<span class="dynamic-link">https://dhdhd.dockerhub.sxxpqp.top/</span>"
  ],
  "debug": true,
  "max-concurrent-downloads": 10,
  "data-root": "/ssd/docker"
}</code></pre>
            <button
              class="copy-btn bg-primary text-white px-3 py-1 rounded text-sm hover:bg-primary/90"
            >
              <i class="fa fa-copy mr-1"></i> 复制配置
            </button>
          </div>

          <p class="text-sm text-gray-500 mt-2">
            说明：将数据目录指向 SSD 可大幅提升 I/O 性能
          </p>
        </div>

        <!-- 建议4 -->
        <div class="bg-light p-4 rounded-lg section-hover">
          <h3 class="font-bold text-lg mb-2 flex items-center text-warning">
            <i class="fa fa-exclamation-circle mr-2"></i> 故障排查流程
          </h3>
          <p class="text-gray-600">配置未生效时的排查步骤：</p>
          <ol class="list-decimal pl-5 mt-2 text-gray-600 space-y-1">
            <li>检查 <code>/etc/docker/daemon.json</code> 格式是否正确（JSON校验工具）</li>
            <li>执行 <code>docker info</code> 查看镜像加速地址是否显示</li>
            <li>ping测试加速源域名是否可连通（<code>ping dhdhd.dockerhub.sxxpqp.top</code>）</li>
            <li>联系技术支持时请提供完整的 <code>docker info</code> 输出</li>
          </ol>
        </div>
      </div>
    </section>
  </main>

  <!-- 页脚 -->
  <footer class="bg-dark text-white py-8">
    <div class="container mx-auto px-4">
      <div class="flex flex-col md:flex-row justify-between items-center">
        <div class="mb-4 md:mb-0">
          <h3 class="text-xl font-bold mb-2">Docker镜像加速服务</h3>
          <p class="text-gray-400">基于域名自动识别的智能加速方案，适配多环境部署</p>
        </div>
        <div class="flex space-x-4">
          <a
            href="#"
            class="text-gray-400 hover:text-white transition-custom dynamic-link"
          >
            <i class="fa fa-home mr-1"></i> 加速源主页
          </a>
          <a
            href="#"
            class="text-gray-400 hover:text-white transition-custom"
          >
            <i class="fa fa-question-circle mr-1"></i> 常见问题
          </a>
          <a
            href="mailto:support@sxxpqp.top"
            class="text-gray-400 hover:text-white transition-custom"
          >
            <i class="fa fa-envelope mr-1"></i> 技术支持
          </a>
        </div>
      </div>
      <div class="border-t border-gray-700 mt-6 pt-6 text-center text-gray-400 text-sm">
        <p>© 2025 Docker镜像加速服务. 所有域名加速服务由sxxpqp.top提供支持</p>
      </div>
    </div>
  </footer>

  <!-- 复制成功提示 -->
  <div
    id="copy-toast"
    class="fixed bottom-4 right-4 bg-success text-white px-4 py-2 rounded-lg shadow-lg opacity-0 transition-opacity duration-300 flex items-center z-50"
  >
    <i class="fa fa-check mr-2"></i>
    <span id="toast-message">复制成功！加速源地址已保存到剪贴板</span>
  </div>

  <!-- 脚本：动态链接 & 复制按钮工具 -->
  <script>
    // —— 1. 动态更新所有 .dynamic-link 元素 —— 
    function updateDynamicLinks() {
      const url = location.href;
      document.querySelectorAll(".dynamic-link").forEach((el) => {
        if (el.tagName.toLowerCase() === "a") {
          el.href = url;
        }
        el.textContent = url;
      });
      const cd = document.getElementById("current-domain");
      if (cd) cd.textContent = url;
    }

    // —— 2. 初始化 code-block 内复制按钮的 data-clipboard-text —— 
    function initCopyButtonText() {
      document.querySelectorAll(".code-block").forEach((block) => {
        const code = block.querySelector("code");
        const btn = block.querySelector(".copy-btn");
        if (code && btn) {
          btn.setAttribute("data-clipboard-text", code.innerText.trim());
        }
      });
    }

    // —— 3. 复制成功/失败提示 —— 
    function showToast(message, isError = false) {
      const toast = document.getElementById("copy-toast");
      const msgEl = document.getElementById("toast-message");
      msgEl.textContent = message;
      // 错误时改背景色
      toast.style.backgroundColor = isError ? "#F53F3F" : "";
      toast.style.opacity = "1";
      setTimeout(() => {
        toast.style.opacity = "0";
      }, 2000);
    }

    // —— 4. 绑定复制事件 —— 
    function initCopyFunctionality() {
      const buttons = document.querySelectorAll(".copy-btn");
      buttons.forEach((button) => {
        // 绑定一次即可
        button.addEventListener("click", function () {
          const text = this.getAttribute("data-clipboard-text") || "";
          console.log("点击复制，内容：", text);
          navigator.clipboard
            .writeText(text)
            .then(() => showToast(`已复制: ${text}`))
            .catch((err) => {
              console.error("复制失败：", err);
              showToast("复制失败，请手动复制", true);
            });
        });
      });
    }

    // —— 5. 页面加载完毕后依次执行 —— 
    document.addEventListener("DOMContentLoaded", () => {
      updateDynamicLinks();
      // 特殊按钮：一键复制加速源地址
      const accelBtn = document.getElementById("copy-accelerator");
      if (accelBtn) {
        accelBtn.setAttribute("data-clipboard-text", location.href);
      }
      initCopyButtonText();
      initCopyFunctionality();
    });
  </script>
</body>
</html>
