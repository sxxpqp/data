# 使用官方Ubuntu 24.04基础镜像
FROM ubuntu:24.04

# 维护者信息
LABEL maintainer="admin@mail.sxxpqp.top"

# 设置环境变量，避免交互提示
ENV TZ=Asia/Shanghai \
    DEBIAN_FRONTEND=noninteractive

# 更新系统并安装必要的软件包
RUN apt-get update && \
    apt-get install -y openssh-server sudo vim net-tools && \
    apt-get clean && \
    rm -rf /var/lib/apt/lists/*

# 创建SSH运行所需的目录
RUN mkdir -p /var/run/sshd

# 配置SSH服务
RUN sed -i 's/#PermitRootLogin prohibit-password/PermitRootLogin yes/' /etc/ssh/sshd_config && \
    sed -i 's/#PasswordAuthentication yes/PasswordAuthentication yes/' /etc/ssh/sshd_config && \
    sed -i 's/UsePAM yes/UsePAM no/' /etc/ssh/sshd_config && \
    sed -i 's/#UseDNS yes/UseDNS no/' /etc/ssh/sshd_config

# 设置root密码（示例为"root"，建议构建时通过环境变量设置）
RUN echo "root:root" | chpasswd

# 创建并配置启动脚本
RUN mkdir -p /opt/startup && \
    echo '#!/bin/bash' > /opt/startup/start.sh && \
    echo '/usr/sbin/sshd -D' >> /opt/startup/start.sh && \
    chmod +x /opt/startup/start.sh

# 暴露SSH端口
EXPOSE 22

# 设置容器启动命令
CMD ["/opt/startup/start.sh"]    